package com.controllers;

import com.alipay.api.AlipayApiException;
import com.liuzg.jswebextra.plugins.AlipayPlugin;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.*;

@Controller
@RequestMapping("/alipay")
public class AliPayController{

    AlipayPlugin alipayPlugin = new AlipayPlugin();

    /*
    * 读取配置信息
    */
    @Autowired
    public AliPayController(@Qualifier("alipay_config")Properties properties){
        new AlipayPlugin(properties.getProperty("APPID"),properties.getProperty("PID"),properties.getProperty("RSA_PRIVATE_KEY"),properties.getProperty("notify_url"),properties.getProperty("return_url"),properties.getProperty("URL"),properties.getProperty("CHARSET"),properties.getProperty("FORMAT"),properties.getProperty("ALIPAY_PUBLIC_KEY"),properties.getProperty("log_path"),properties.getProperty("SIGNTYPE"),properties.getProperty("input_charset"),properties.getProperty("sign_type"),properties.getProperty("transport"));
    }
    /**
     * 支付宝支付
     * @param out_trade_no 商户订单号，商户网站订单系统中唯一订单号，必填
     * @param subject 订单名称，必填
     * @param total_amount 付款金额，必填
     * @param body 商品描述，可空
     * @param timeout_express 超时时间 可空
     * @param product_code 销售产品码 可空
     */
    @RequestMapping("/doalipay")
    @ResponseBody
    public void doalipay(String out_trade_no, String subject, String total_amount, String body, String timeout_express, String product_code, HttpServletRequest httpRequest, HttpServletResponse httpResponse){
        try {
            alipayPlugin.doPay(out_trade_no,subject,total_amount,body,timeout_express,product_code, httpRequest,httpResponse);
        } catch (AlipayApiException e) {
            e.printStackTrace();
        }
    }

    @RequestMapping("/getNotifyResultPay")
    @ResponseBody
    public String getNotifyResultPay(HttpServletRequest request){
        alipayPlugin.getNotifyResultPay(request);
        return null;
    }

    @RequestMapping("/")
    public String getReturn_Url(HttpServletRequest request){
        alipayPlugin.getReturnResultPay(request);
        return null;
    }

}
